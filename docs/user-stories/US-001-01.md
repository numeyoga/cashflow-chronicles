# US-001-01 : Charger un fichier TOML valide

## Informations générales

- **Epic parent** : EPIC-001 - Stockage et Parser TOML
- **Priorité** : Critique
- **Complexité** : Moyenne
- **Sprint** : Sprint 1

## Prérequis

- Aucun (première user story de l'epic)
- Bibliothèque de parsing TOML installée (`smol-toml` ou `@ltd/j-toml`)

## Profil utilisateur

**Développeur système** ou **Utilisateur final** au démarrage de l'application

## Objectif business

Permettre à l'application de charger les données financières depuis un fichier TOML pour que l'utilisateur puisse consulter et gérer ses finances.

## Objectifs concrets

1. Parser un fichier TOML conforme à la spécification v1.0.0
2. Charger toutes les sections requises : `metadata`, `currency`, `account`, `transaction`, `budget`, `recurring`
3. Convertir les données TOML en objets JavaScript
4. Valider que toutes les sections obligatoires sont présentes
5. Afficher un message de succès avec le nombre d'entités chargées

## Scénario nominal

### Étapes

1. L'utilisateur sélectionne un fichier TOML via l'interface
2. L'application lit le contenu du fichier
3. L'application parse le contenu avec la bibliothèque TOML
4. L'application vérifie la présence de la propriété `version`
5. L'application vérifie la présence des sections obligatoires
6. L'application charge les données en mémoire
7. L'application affiche un message de succès : "Fichier chargé avec succès : X comptes, Y transactions, Z budgets"

### Temps d'exécution attendu

- **< 1 seconde** pour un fichier avec 10 000 transactions

## Données de test

### Données entrantes

**Fichier** : `test-valid-minimal.toml`

```toml
version = "1.0.0"

[metadata]
created = "2025-01-01T00:00:00Z"
lastModified = "2025-01-01T00:00:00Z"
defaultCurrency = "CHF"
owner = "Test User"

[[currency]]
code = "CHF"
name = "Swiss Franc"
symbol = "CHF"
decimalPlaces = 2
isDefault = true

[[account]]
id = "acc_001"
name = "Assets:Bank:CHF"
type = "Assets"
currency = "CHF"
opened = "2025-01-01"

[[account]]
id = "acc_002"
name = "Expenses:Test"
type = "Expenses"
currency = "CHF"
opened = "2025-01-01"

[[transaction]]
id = "txn_001"
date = "2025-01-15"
description = "Test transaction"

  [[transaction.posting]]
  accountId = "acc_001"
  amount = 100.00
  currency = "CHF"

  [[transaction.posting]]
  accountId = "acc_002"
  amount = -100.00
  currency = "CHF"
```

### Données sortantes (en mémoire)

```javascript
{
  version: "1.0.0",
  metadata: {
    created: Date("2025-01-01T00:00:00Z"),
    lastModified: Date("2025-01-01T00:00:00Z"),
    defaultCurrency: "CHF",
    owner: "Test User"
  },
  currencies: [
    {
      code: "CHF",
      name: "Swiss Franc",
      symbol: "CHF",
      decimalPlaces: 2,
      isDefault: true
    }
  ],
  accounts: [
    {
      id: "acc_001",
      name: "Assets:Bank:CHF",
      type: "Assets",
      currency: "CHF",
      opened: Date("2025-01-01")
    },
    {
      id: "acc_002",
      name: "Expenses:Test",
      type: "Expenses",
      currency: "CHF",
      opened: Date("2025-01-01")
    }
  ],
  transactions: [
    {
      id: "txn_001",
      date: Date("2025-01-15"),
      description: "Test transaction",
      postings: [
        {
          accountId: "acc_001",
          amount: 100.00,
          currency: "CHF"
        },
        {
          accountId: "acc_002",
          amount: -100.00,
          currency: "CHF"
        }
      ]
    }
  ]
}
```

### Message de succès attendu

```
✓ Fichier chargé avec succès
  - 2 comptes
  - 1 transaction
  - 0 budgets
  - 0 récurrences
```

## Critères d'acceptation

- [ ] Le fichier TOML est parsé sans erreur
- [ ] Toutes les sections obligatoires sont présentes
- [ ] Les dates sont converties en objets Date JavaScript
- [ ] Les nombres décimaux sont correctement parsés
- [ ] Le chargement prend moins de 1 seconde pour 10 000 transactions
- [ ] Un message de succès détaillé est affiché
- [ ] Les données sont accessibles en mémoire pour les autres composants

## Notes techniques

- Utiliser `smol-toml` (recommandé) ou `@ltd/j-toml` pour le parsing
- Encoder le fichier en UTF-8
- Gérer les dates ISO 8601 (format TOML datetime)
- Valider la présence de `version` avant tout traitement

## Dépendances

- Installation de la bibliothèque TOML
- Système de fichiers accessible (Node.js ou API File Browser)
