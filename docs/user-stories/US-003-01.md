# US-003-01 : Cr√©er un compte bancaire (Assets)

## Informations g√©n√©rales

- **Epic parent** : EPIC-003 - Gestion des Comptes
- **Priorit√©** : Critique
- **Complexit√©** : Moyenne
- **Sprint** : Sprint 2

## Pr√©requis

- **US-002-01** : Ajouter une nouvelle devise (pour associer une devise au compte)
- **US-001-03** : Sauvegarder les donn√©es en fichier TOML

## Profil utilisateur

**Utilisateur** qui souhaite enregistrer un nouveau compte bancaire pour suivre ses finances

## Objectif business

Permettre √† l'utilisateur de cr√©er des comptes bancaires (Assets) pour suivre ses avoirs et effectuer des transactions.

## Objectifs concrets

1. Cr√©er un compte de type "Assets" avec un nom hi√©rarchique
2. Associer une devise au compte
3. D√©finir une date d'ouverture
4. Valider le format du nom hi√©rarchique
5. Valider la coh√©rence du type avec le premier segment du nom
6. Persister le compte dans le fichier TOML
7. Afficher le compte dans la liste hi√©rarchique

## Sc√©nario nominal

### √âtapes

1. L'utilisateur acc√®de √† **Comptes**
2. L'utilisateur clique sur **[+ Nouveau compte]**
3. Un formulaire s'affiche avec les champs :
   - Type : `Assets` (s√©lectionn√©)
   - Nom du compte : (√† saisir)
   - Devise : (liste d√©roulante)
   - Date d'ouverture : (date picker)
   - Description : (optionnel)
4. L'utilisateur saisit :
   - Type : `Assets`
   - Nom : `Assets:Bank:CHF:PostFinance`
   - Devise : `CHF`
   - Date d'ouverture : `2025-01-01`
   - Description : `Compte bancaire principal PostFinance`
5. L'utilisateur clique sur **[Cr√©er]**
6. L'application valide les donn√©es (V-ACC-001 √† V-ACC-013)
7. L'application g√©n√®re un ID unique (ex: `acc_001`)
8. L'application ajoute le compte en m√©moire
9. L'application sauvegarde le fichier TOML
10. L'application affiche : "‚úì Compte 'Assets:Bank:CHF:PostFinance' cr√©√© avec succ√®s"
11. Le compte appara√Æt dans la hi√©rarchie des Assets

## Donn√©es de test

### Donn√©es entrantes (formulaire)

```javascript
{
  type: "Assets",
  name: "Assets:Bank:CHF:PostFinance",
  currency: "CHF",
  opened: "2025-01-01",
  description: "Compte bancaire principal PostFinance",
  metadata: {
    iban: "CH93 0076 2011 6238 5295 7",
    institution: "PostFinance"
  }
}
```

### Donn√©es sortantes (fichier TOML)

```toml
[[account]]
id = "acc_001"
name = "Assets:Bank:CHF:PostFinance"
type = "Assets"
currency = "CHF"
opened = "2025-01-01"
description = "Compte bancaire principal PostFinance"

  [account.metadata]
  iban = "CH93 0076 2011 6238 5295 7"
  institution = "PostFinance"
```

### Affichage dans la liste hi√©rarchique

```
üè¶ Assets (Actifs)

‚îú‚îÄ Bank
‚îÇ  ‚îú‚îÄ CHF
‚îÇ  ‚îÇ  ‚îú‚îÄ üí≥ PostFinance
‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ 5'000.00 CHF
‚îÇ  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ üí≥ UBS
‚îÇ  ‚îÇ     ‚îî‚îÄ 2'500.00 CHF
‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ EUR
‚îÇ     ‚îî‚îÄ üí≥ Revolut
‚îÇ        ‚îî‚îÄ 100.00 EUR (95.00 CHF)
‚îÇ
‚îî‚îÄ Cash
   ‚îî‚îÄ üí∞ CHF
      ‚îî‚îÄ 200.00 CHF

Total Assets : 7'795.00 CHF
```

## Crit√®res d'acceptation

- [ ] Le formulaire de cr√©ation de compte est accessible
- [ ] Le nom hi√©rarchique doit contenir au moins 2 segments s√©par√©s par `:`
- [ ] Le premier segment doit correspondre au type s√©lectionn√©
- [ ] Un ID unique est g√©n√©r√© automatiquement (format `acc_XXX`)
- [ ] La devise doit exister dans la liste des devises
- [ ] La date d'ouverture doit √™tre au format YYYY-MM-DD
- [ ] Le compte est sauvegard√© dans le fichier TOML
- [ ] Le compte appara√Æt dans la hi√©rarchie correspondant √† son type
- [ ] Le solde initial est de 0 (sera aliment√© par transactions)
- [ ] Un message de confirmation est affich√©

## Validation

### R√®gles appliqu√©es

- **V-ACC-001** : ID au format `acc_XXX`
- **V-ACC-002** : ID unique
- **V-ACC-003** : Nom non vide
- **V-ACC-004** : Nom unique
- **V-ACC-005** : Type valide (Assets, Liabilities, Income, Expenses, Equity)
- **V-ACC-006** : Devise existante
- **V-ACC-007** : Date d'ouverture valide (YYYY-MM-DD)
- **V-ACC-009** : Au moins 2 segments dans le nom
- **V-ACC-010** : Premier segment = type
- **V-ACC-011** : Aucun segment vide
- **V-ACC-013** : Coh√©rence hi√©rarchique avec les comptes parents

### Messages d'erreur

#### Nom invalide - Segments insuffisants

```
‚ùå Nom de compte invalide : "Assets:PostFinance"

Le nom doit contenir au moins 2 segments s√©par√©s par ':'.

Format recommand√© : Assets:Category:Subcategory:Name

Exemples valides :
  - Assets:Bank:CHF:PostFinance
  - Assets:Cash:CHF
  - Assets:Investments:Stocks
```

#### Incoh√©rence type / premier segment

```
‚ùå Incoh√©rence d√©tect√©e

Type s√©lectionn√© : Assets
Premier segment du nom : Expenses

Le premier segment doit correspondre au type.

Suggestions :
  - Changez le type en "Expenses"
  - Ou changez le nom en "Assets:..."
```

#### Nom d√©j√† existant

```
‚ùå Compte d√©j√† existant

Le nom "Assets:Bank:CHF:PostFinance" existe d√©j√† (acc_005).

Action : Choisissez un nom diff√©rent ou modifiez le compte existant.
```

#### Devise inexistante

```
‚ùå Devise non configur√©e

La devise "USD" n'existe pas dans votre configuration.

Action : Ajoutez d'abord la devise USD dans Param√®tres > Devises
[Aller aux param√®tres]
```

## Format du nom hi√©rarchique

### Structure recommand√©e

```
Assets
  ‚îú‚îÄ Bank
  ‚îÇ    ‚îú‚îÄ {Currency}
  ‚îÇ    ‚îÇ    ‚îî‚îÄ {Institution/Account}
  ‚îÇ    ‚îî‚îÄ ...
  ‚îÇ
  ‚îú‚îÄ Cash
  ‚îÇ    ‚îî‚îÄ {Currency}
  ‚îÇ
  ‚îú‚îÄ Investments
  ‚îÇ    ‚îú‚îÄ Stocks
  ‚îÇ    ‚îú‚îÄ Bonds
  ‚îÇ    ‚îî‚îÄ Crypto
  ‚îÇ
  ‚îî‚îÄ Other

Exemples :
  Assets:Bank:CHF:PostFinance
  Assets:Bank:EUR:Revolut
  Assets:Cash:CHF
  Assets:Investments:Stocks:SwissQuote
  Assets:Investments:Crypto:Bitcoin
```

### Assistant de cr√©ation (auto-suggestion)

Le formulaire peut sugg√©rer des structures courantes :

```
Type s√©lectionn√© : Assets

Mod√®les sugg√©r√©s :
  [üìä] Compte bancaire     ‚Üí Assets:Bank:{Devise}:{Banque}
  [üí∞] Esp√®ces             ‚Üí Assets:Cash:{Devise}
  [üìà] Investissements     ‚Üí Assets:Investments:{Type}:{Nom}
  [üè†] Immobilier          ‚Üí Assets:RealEstate:{Propri√©t√©}
  [üöó] V√©hicules           ‚Üí Assets:Vehicles:{V√©hicule}
```

## M√©tadonn√©es additionnelles (optionnelles)

Pour les comptes bancaires, permettre d'ajouter des m√©tadonn√©es :

```toml
[account.metadata]
iban = "CH93 0076 2011 6238 5295 7"
institution = "PostFinance"
accountNumber = "01-123456-7"
swiftCode = "POFICHBEXXX"
contactPerson = "John Doe"
notes = "Compte joint avec Marie"
```

## Interface de cr√©ation guid√©e

### √âtape 1 : Choisir le type de compte

```
Quel type de compte souhaitez-vous cr√©er ?

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üè¶ Assets (Actifs)                ‚îÇ
‚îÇ Ce que vous poss√©dez              ‚îÇ
‚îÇ Ex: Compte bancaire, esp√®ces      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üí≥ Liabilities (Passifs)          ‚îÇ
‚îÇ Ce que vous devez                 ‚îÇ
‚îÇ Ex: Carte de cr√©dit, pr√™t         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üí∞ Income (Revenus)               ‚îÇ
‚îÇ Vos sources de revenus            ‚îÇ
‚îÇ Ex: Salaire, bonus                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

... (Expenses, Equity)
```

### √âtape 2 : D√©tails du compte

```
üìù Nouveau compte Assets

Nom du compte *
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Assets:Bank:CHF:PostFinance         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

üí° Format : Assets:Category:Subcategory:Name

Devise *
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ CHF - Swiss Franc               [‚ñæ] ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

Date d'ouverture *
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 2025-01-01                      [üìÖ]‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

Description
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Compte bancaire principal           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

[Annuler]  [Cr√©er le compte]
```

## Notes techniques

### G√©n√©ration de l'ID

```typescript
function generateAccountId(existingAccounts: Account[]): string {
  const maxId = Math.max(
    0,
    ...existingAccounts.map(a => parseInt(a.id.replace('acc_', '')))
  );
  const nextId = maxId + 1;
  return `acc_${nextId.toString().padStart(3, '0')}`;
}

// Exemples :
// acc_001, acc_002, ..., acc_010, ..., acc_100
```

### Validation du nom hi√©rarchique

```typescript
function validateAccountName(name: string, type: string): ValidationResult {
  const segments = name.split(':');

  // V-ACC-009 : Au moins 2 segments
  if (segments.length < 2) {
    return { valid: false, error: 'V-ACC-009: At least 2 segments required' };
  }

  // V-ACC-010 : Premier segment = type
  if (segments[0] !== type) {
    return { valid: false, error: `V-ACC-010: First segment must be "${type}"` };
  }

  // V-ACC-011 : Aucun segment vide
  if (segments.some(s => s.trim() === '')) {
    return { valid: false, error: 'V-ACC-011: Empty segments not allowed' };
  }

  return { valid: true };
}
```

## D√©pendances

- US-002-01 : Ajouter une nouvelle devise
- US-001-03 : Sauvegarder les donn√©es en fichier TOML
- US-001-05 : Valider la structure du fichier TOML
